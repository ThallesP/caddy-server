:{$PORT} {
    # Only allow specific IP to reverse proxy
    @allowed {
        header X-Real-IP {$ALLOWED_PROXY_IP}
    }
    
    # Handle requests from allowed IP
    handle @allowed {
        reverse_proxy n8n.railway.internal:5678
    }

    # Reject all other requests
    handle {
        respond 403
    }
}
